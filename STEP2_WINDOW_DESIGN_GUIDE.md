# Step2 窗型设计功能说明文档

## 概述

Step2 窗型设计是门窗设计工具的核心功能模块，提供完整的窗型选择、2D画布编辑、窗扇配置和配件设置功能。本模块完全按照产品交互文档要求实现，适配 iPad 端的操作习惯。

## 访问路径

```
主页 → 开始设计 → Step1 基础信息 → Step2 窗型设计
或
直接访问: http://localhost:3000/design (进入后点击"下一步"进入Step2)
```

## 功能模块

### 一、窗型推荐与选择

#### 1.1 初始状态
- 进入 Step2 后，首先展示窗型推荐列表
- 这是**必要流程，不可跳过**
- 提供 6 种常见窗型选择

#### 1.2 窗型选项

| 窗型 | 结构 | 特点 | 适用场景 |
|------|------|------|----------|
| 推拉窗 2扇 | 2列1行 | 易开启、通风好、经济实用 | 客厅阳台 |
| 推拉窗 3扇 | 3列1行 | 采光优、视野广、高端大气 | 大阳台 |
| 平开窗 2扇 | 2列1行 | 密封好、隔音强、安全可靠 | 卧室 |
| 落地窗 | 2列2行 | 全景视野、豪华大气、通透明亮 | 客厅、阳台 |
| 固定窗 2格 | 2列1行 | 经济实惠、保温好、简约大气 | 走廊 |
| 组合窗 | 3列2行 | 功能全、美观、实用性强 | 复杂空间 |

#### 1.3 选择交互
- 点击窗型卡片即可选择
- 每个卡片显示：
  - 窗型效果图
  - 窗型名称和描述
  - 特点标签（Badge）
- 支持悬停放大和点击反馈

### 二、主设计界面布局

选择窗型后自动进入主设计界面，采用三栏布局：

```
┌─────────────────────────────────────────────────┐
│ 顶部工具栏：切换窗型 + 尺寸显示                  │
├──────────┬──────────────────────┬────────────────┤
│          │                      │                │
│  左侧    │     中间2D画布       │   右侧配件面板 │
│ 俯视图   │  （主工作区）        │ （选中窗扇时）  │
│  +       │                      │                │
│ 尺寸调整 │                      │                │
│          │                      │                │
└──────────┴──────────────────────┴────────────────┘
```

### 三、左上角模块（俯视图区域）

#### 3.1 切换选型入口
- **位置**: 顶部工具栏左侧
- **按钮**: "切换窗型" + 网格图标
- **功能**: 点击重新唤起窗型推荐列表
- **交互**: 
  - 可随时更换窗型
  - 切换后画布自动更新为新窗型结构

#### 3.2 俯视图功能
- **位置**: 左侧面板上部
- **尺寸**: 固定宽度 256px（w-64）
- **功能**:
  - 展示当前方案的俯视视图
  - 与核心画布实时联动
  - 明确显示当前编辑区域

#### 3.3 俯视图交互
- 点击俯视图中的任意窗扇，核心画布同步选中
- 选中的窗扇在俯视图中高亮显示
- 开启扇在俯视图中显示蓝色圆点标记
- 视图实时同步画布操作（复制、调整等）

#### 3.4 整体尺寸调整
- 宽度输入框：调整整体窗户宽度
- 高度输入框：调整整体窗户高度
- 单位：毫米（mm）
- 实时同步到画布显示

### 四、核心画布（2D画布）模块

#### 4.1 画布特性
- **位置**: 中间主工作区
- **背景**: 白色卡片 + 阴影效果
- **边框**: 4px 深灰色边框模拟窗框
- **缩放**: 自动按比例缩放以适应屏幕

#### 4.2 窗扇显示
每个窗扇显示：
- 边框：固定扇（灰色）/ 开启扇（蓝色）
- 内容：开启扇显示把手图标和文字
- 尺寸标注：选中时显示宽度和高度
- 拖拽控制点：选中时在右下角显示

#### 4.3 区域结构复制
- **触发**: 选中窗扇后点击复制按钮
- **位置**: 窗扇右上角悬浮按钮
- **功能**: 生成相同结构的窗扇
- **效果**: 
  - 复制的窗扇偏移 50px
  - 保留原窗扇的所有属性
  - 自动分配新ID

**快捷操作** (待实现):
- 长按窗扇拖拽即可复制

#### 4.4 尺寸调整

**方式一：拖拽调整**
- 选中窗扇后，右下角出现拖拽控制点
- 拖拽控制点可调整宽度和高度
- 实时显示调整后的尺寸

**方式二：精确输入**
- 选中窗扇后，右侧面板显示尺寸输入框
- 支持直接输入精确数值（mm）
- 输入后立即应用到画布

#### 4.5 开启扇与材质设置

**设置为开启扇**:
- 选中窗扇后点击"设置"按钮
- 切换固定扇 ↔ 开启扇状态
- 开启扇显示蓝色背景和把手图标

**纱窗材质** (选中开启扇后可用):
- 金刚网：防盗、防蚊、耐用
- 尼龙网：通风、透光、经济
- 不锈钢网：防锈、坚固、高端

**玻璃样式** (所有窗扇可用):
- 单层玻璃 (5mm)：经济型
- 双层中空 (5+9A+5)：隔音、保温
- Low-E玻璃 (5+12A+5)：节能、隔热、高端
- 夹胶玻璃 (5+0.76PVB+5)：安全、隔音、防爆

### 五、右侧配件设置面板

#### 5.1 唤起条件
- 在核心画布中选中任意窗扇
- 自动在右侧显示配件设置面板
- 未选中时不显示

#### 5.2 窗扇信息
- 窗扇编号：#1, #2, #3...
- 当前尺寸：宽 × 高 (mm)
- 窗扇类型：固定扇 / 开启扇

#### 5.3 尺寸精确调整
- 宽度输入框（mm）
- 高度输入框（mm）
- 实时同步到画布

#### 5.4 执手设置（仅开启扇）

**执手高度**:
- 滑动条控制：800-1200mm
- 数值输入框：精确输入
- 默认值：1000mm
- 实时同步到画布预览

**执手样式** (4种):
1. 🔧 拨叉执手
2. 🔐 两点锁执手
3. ⭕ 圆柄执手
4. ▬ 平柄执手

#### 5.5 配件选择与设置

每个配件支持：
- 材质选择
- 样式选择
- 下拉菜单展示详细选项

**配件列表**:

1. **下降料**
   - 材质：铝合金 / 不锈钢 / 塑钢
   - 样式：标准型 / 加厚型 / 静音型

2. **隔栅**
   - 材质：铝合金 / 不锈钢
   - 样式：竖条 / 横条 / 格子

3. **护栏**
   - 材质：铝合金 / 不锈钢 / 锌合金
   - 样式：直杆 / 弯杆 / 艺术栏杆

4. **隔条**
   - 材质：铝合金 / 不锈钢
   - 样式：单条 / 双条 / 装饰条

5. **新风系统**
   - 材质：ABS / 铝合金
   - 样式：侧挂式 / 顶置式 / 隐藏式

### 六、交互流程总结

```
1. 进入 Step2 → 显示窗型推荐列表
   ↓
2. 选择窗型 → 自动生成窗扇布局
   ↓
3. 主设计界面
   ├─ 左侧俯视图：全局视角，点击定位
   ├─ 中间画布：编辑窗扇
   └─ 右侧面板：配置参数（选中窗扇时）
   ↓
4. 编辑操作
   ├─ 选中窗扇
   ├─ 调整尺寸（拖拽或输入）
   ├─ 设置开启扇
   ├─ 配置执手
   ├─ 选择材质
   └─ 添加配件
   ↓
5. 复制窗扇（可选）
   ↓
6. 切换窗型（可选，返回步骤1）
   ↓
7. 完成设计 → 下一步
```

### 七、技术实现

#### 7.1 核心技术
- **React Hooks**: 状态管理
- **TypeScript**: 类型安全
- **Tailwind CSS**: 样式系统
- **shadcn/ui**: UI组件库

#### 7.2 关键组件
- `WindowTypeDesigner`: 主组件
- `Button`, `Card`, `Input`, `Slider`: UI组件
- `DropdownMenu`: 下拉菜单

#### 7.3 状态管理
```typescript
const [showTypeSelector, setShowTypeSelector] = useState(true)
const [selectedType, setSelectedType] = useState(null)
const [selectedPane, setSelectedPane] = useState(null)
const [panes, setPanes] = useState([])
const [canvasWidth, setCanvasWidth] = useState(2400)
const [canvasHeight, setCanvasHeight] = useState(1800)
const [handleHeight, setHandleHeight] = useState(1000)
const [handleStyle, setHandleStyle] = useState("fork")
```

#### 7.4 数据结构
```typescript
interface Pane {
  id: number
  x: number
  y: number
  width: number
  height: number
  isOpenable: boolean
  screenMaterial?: string
  glassType?: string
  handleHeight?: number
  handleStyle?: string
}
```

### 八、iPad 适配

#### 8.1 触摸优化
- 所有按钮最小尺寸 44×44px
- 支持触摸点击和拖拽
- 悬停效果转换为激活状态
- 禁用点击高亮

#### 8.2 布局优化
- 响应式三栏布局
- 左右面板可滚动
- 中间画布自适应缩放
- 横屏/竖屏自动适配

#### 8.3 操作优化
- 大号输入框和滑动条
- 清晰的视觉反馈
- 直观的操作入口
- 流畅的过渡动画

### 九、特色功能

#### 9.1 实时同步
- 俯视图与画布实时联动
- 尺寸调整立即生效
- 状态变化即时反馈

#### 9.2 智能布局
- 根据窗型自动生成窗扇
- 窗扇均匀分布
- 自动计算位置和尺寸

#### 9.3 视觉反馈
- 选中状态高亮显示
- 开启扇特殊标记
- 悬停效果明显
- 操作按钮浮现

#### 9.4 灵活配置
- 支持任意尺寸调整
- 支持窗扇复制
- 支持窗型切换
- 支持详细配置

### 十、使用建议

#### 10.1 推荐流程
1. 在 Step1 输入准确的宽度和高度
2. 选择最接近需求的窗型
3. 使用俯视图快速定位要编辑的窗扇
4. 在画布中调整窗扇尺寸和位置
5. 设置需要开启的窗扇
6. 为开启扇配置执手和纱窗
7. 为所有窗扇选择玻璃类型
8. 根据需要添加配件
9. 检查俯视图确认整体布局
10. 进入下一步

#### 10.2 快捷操作
- 俯视图快速选中窗扇
- 画布直接点击切换选中
- 复制按钮快速生成副本
- 切换窗型重新开始

#### 10.3 注意事项
- 尺寸单位统一为毫米（mm）
- 执手高度建议范围 800-1200mm
- 开启扇数量不宜过多
- 注意通风和采光平衡

### 十一、未来优化

#### 短期优化
- [ ] 支持长按拖拽复制
- [ ] 支持窗扇删除功能
- [ ] 支持撤销/重做操作
- [ ] 支持键盘快捷键

#### 中期优化
- [ ] 3D 预览功能
- [ ] 材质贴图实时渲染
- [ ] 智能推荐配件组合
- [ ] 导出 CAD 图纸

#### 长期优化
- [ ] AI 智能优化布局
- [ ] 协同编辑功能
- [ ] 云端保存和同步
- [ ] 移动端完整支持

### 十二、相关文件

- 组件文件: `/components/window-type-designer.tsx`
- 主页面: `/app/design/page.tsx`
- UI组件: `/components/ui/*`

### 十三、更新日志

#### v1.0.0 (2024-10-31)
- ✅ 完整实现窗型推荐和选择
- ✅ 实现左上角俯视图和切换入口
- ✅ 实现核心2D画布
- ✅ 实现右侧配件设置面板
- ✅ 支持窗扇选中、复制、尺寸调整
- ✅ 支持开启扇设置
- ✅ 支持执手高度和样式设置
- ✅ 支持纱窗材质和玻璃类型选择
- ✅ 支持配件选择和配置
- ✅ 完美适配 iPad
- ✅ 无 linter 错误

---

**Step2 窗型设计功能已完整实现，可以正常使用！** 🎉

