# 门窗设计工具 - 5步骤流程更新

## 更新概述

将原来的4步骤设计流程优化为5步骤，使设计过程更加清晰和合理。

## 更新时间

2025年11月6日

## 变更详情

### 步骤流程对比

#### 原4步骤流程：
1. **基础选型** - 户型信息与智能推荐
2. **窗型设计** - 结构设计与开启位（包含选择窗型和详细设计）
3. **配置选择** - 材质与参数设置
4. **成果输出** - 报价单与效果图

#### 新5步骤流程：
1. **基础选型** - 户型信息与智能推荐（保持不变）
2. **选择窗型** - 选择合适的窗型结构（新增独立步骤）
3. **窗型设计** - 结构设计与开启位（详细设计部分）
4. **配置选择** - 材质与参数设置
5. **成果输出** - 报价单与效果图

### 主要改进

#### 1. 步骤2：选择窗型（新增）

**功能特点：**
- 独立的窗型选择界面
- 显示10种常用窗型配置
- 智能标签筛选功能
- 可视化窗型预览
- 选中后自动进入下一步

**窗型库包含：**
- 001矩形1分格 - 单格
- 002矩形2分格 - 上下两格
- 003矩形2分格 - 左右两格
- 004矩形3分格 - 上中下三格
- 005矩形3分格 - 左中右三格
- 006/007矩形3分格 - 上下不均分
- 010矩形4分格 - 田字格
- 019矩形4分格 - 四扇推拉
- 031矩形6分格 - 上下各三格

**交互功能：**
- 标签筛选（简洁、经济、通风、推拉、对称等）
- 标签展开/收起
- 窗型预览和选中状态
- 已选窗型显示

#### 2. 步骤3：窗型设计（优化）

**功能改进：**
- 支持预选窗型直接进入
- 自动初始化选中窗型的梃布局
- 继续支持手动调整和添加梃
- 完整的区域配置功能

**工作流程：**
1. 从步骤2自动传递选中的窗型
2. 自动初始化梃的位置
3. 用户可以进一步调整和配置
4. 支持切换到其他窗型

#### 3. 步骤4-5：配置选择与成果输出

- 保持原有功能不变
- 步骤编号自动更新

## 技术实现

### 文件修改

1. **app/design/page.tsx**
   - 更新步骤定义从4步到5步
   - 添加窗型数据和筛选逻辑
   - 实现步骤2的窗型选择界面
   - 传递选中窗型到步骤3

2. **components/window-type-designer.tsx**
   - 添加 `preselectedType` 属性
   - 支持预选窗型初始化
   - 自动隐藏窗型选择器（如果已预选）
   - 保持向后兼容性

### 新增状态管理

```typescript
const [selectedWindowType, setSelectedWindowType] = useState<any>(null)
const [selectedTags, setSelectedTags] = useState<string[]>([])
const [isTagExpanded, setIsTagExpanded] = useState(false)
```

### 核心函数

```typescript
// 窗型选择处理
const handleWindowTypeSelect = (type) => {
  setSelectedWindowType(type)
  nextStage() // 自动进入下一步
}

// 标签筛选
const filteredWindowTypes = useMemo(() => {
  if (selectedTags.length === 0) return windowTypeOptions
  return windowTypeOptions.filter(type => 
    selectedTags.some(tag => type.features.includes(tag))
  )
}, [selectedTags])
```

## 用户体验改进

### 1. 更清晰的流程
- 窗型选择独立出来，避免信息过载
- 每个步骤目标更明确
- 降低用户认知负担

### 2. 更好的引导
- 步骤2选择窗型后自动进入步骤3
- 步骤指示器清晰显示当前进度
- 支持前后步骤跳转

### 3. 更强的灵活性
- 可以随时回到步骤2重新选择窗型
- 步骤3支持在预选基础上继续调整
- 保留所有自定义功能

## 视觉设计

### 步骤指示器
- 5个圆形步骤点
- 当前步骤高亮显示
- 完成步骤显示对勾
- 步骤间连接线动态更新

### 窗型选择界面
- 响应式网格布局（2-6列）
- 窗型卡片带有可视化预览
- 选中状态明显反馈
- 标签筛选紧凑布局

### 颜色编码
- 蓝色：当前步骤
- 绿色：已完成步骤
- 灰色：未开始步骤
- 主题色：选中和强调元素

## 测试建议

### 基本流程测试
1. 进入设计页面
2. 完成步骤1的基础选型
3. 在步骤2选择一个窗型
4. 验证自动进入步骤3
5. 确认窗型正确初始化
6. 完成后续步骤

### 交互测试
1. 测试标签筛选功能
2. 测试标签展开/收起
3. 测试窗型选中状态
4. 测试步骤间跳转
5. 测试返回重新选择

### 兼容性测试
1. 桌面端完整流程
2. iPad 响应式布局
3. 移动端基本功能
4. 不同浏览器测试

## 后续优化建议

### 短期
1. 添加窗型搜索功能
2. 优化窗型预览效果
3. 添加常用窗型收藏
4. 增加窗型推荐算法

### 中期
1. 扩展窗型库（更多样式）
2. 添加自定义窗型功能
3. 窗型模板保存和分享
4. AI智能推荐窗型

### 长期
1. 3D窗型预览
2. VR/AR 窗型展示
3. 窗型性能模拟
4. 社区窗型库

## 版本信息

- **版本**: v2.5.0
- **类型**: 功能优化
- **影响范围**: 设计流程核心
- **向后兼容**: 是

## 相关文档

- [设计流程指南](./STEP2_WINDOW_DESIGN_GUIDE.md)
- [窗型设计器文档](./STEP2_V2.4_ENHANCED_SELECTOR.md)
- [UI组件规范](./components.json)

---

更新完成 ✓

