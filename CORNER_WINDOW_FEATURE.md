# 转角窗类型功能实现

## 功能概述

在"填信息"步骤中新增窗户类型选择功能，支持一字窗和转角窗（L型、U型）的尺寸输入。

## 更新时间

2025年11月6日

---

## 功能说明

### 1. 窗户类型

用户可以选择两种基本窗户类型：

#### 一字窗（默认）
- 保持原有功能不变
- 单一矩形窗户
- 只需填写宽度和高度

#### 转角窗
- 支持L型窗和U型窗两种子类型
- 可以为每个边分别填写尺寸
- 带有可视化图示说明

---

## 转角窗类型详解

### L型窗

**结构组成**：
- 边A：垂直边
- 边B：水平边

**可视化图示**：
```
┌────┐
│ A  │
│    │
│    │
└────┴────────┐
     │   B    │
     └────────┘
```

**尺寸输入**：
- 边A（垂直边）
  - 宽度 (mm)
  - 高度 (mm)
- 边B（水平边）
  - 宽度 (mm)
  - 高度 (mm)

**适用场景**：
- 阳台转角
- 房间拐角
- 景观窗设计

### U型窗

**结构组成**：
- 边A：左垂直边
- 边B：底部水平边
- 边C：右垂直边

**可视化图示**：
```
┌───┐        ┌───┐
│ A │        │ C │
│   │        │   │
│   │        │   │
└───┴────────┴───┘
    │   B    │
    └────────┘
```

**尺寸输入**：
- 边A（左垂直边）
  - 宽度 (mm)
  - 高度 (mm)
- 边B（底部水平边）
  - 宽度 (mm)
  - 高度 (mm)
- 边C（右垂直边）
  - 宽度 (mm)
  - 高度 (mm)

**适用场景**：
- 凸窗设计
- 全景观景窗
- 三面采光设计

---

## 界面设计

### 1. 窗户类型选择器

```
┌─────────────────────────────────┐
│ 窗户类型                         │
│                                 │
│  ┌──────────┐  ┌──────────┐   │
│  │ 一字窗   │  │ 转角窗   │   │
│  └──────────┘  └──────────┘   │
└─────────────────────────────────┘
```

**交互特点**：
- 两个等宽按钮
- 选中状态：蓝色边框 + 浅蓝色背景
- 未选中状态：灰色边框 + 透明背景
- 悬停效果：边框颜色变化

### 2. 一字窗模式（默认）

```
┌─────────────────────────────────┐
│ 窗型信息                         │
│                                 │
│ 窗户类型：[一字窗] [ 转角窗 ]   │
│                                 │
│ ┌──────────┐  ┌──────────┐    │
│ │ 宽度     │  │ 高度     │    │
│ │ 1800 mm  │  │ 1500 mm  │    │
│ └──────────┘  └──────────┘    │
└─────────────────────────────────┘
```

**特点**：
- 大号输入框（h-12）
- 粗体文字（font-semibold）
- 数字键盘输入

### 3. 转角窗模式 - L型

```
┌─────────────────────────────────┐
│ 窗型信息                         │
│                                 │
│ 窗户类型：[ 一字窗 ] [转角窗]   │
│                                 │
│ 转角窗类型：[L型窗] [ U型窗 ]   │
│                                 │
│ ┌─────────────────────────────┐ │
│ │  图示说明                   │ │
│ │  ┌────┐                     │ │
│ │  │ A  │                     │ │
│ │  └────┴────┐                │ │
│ │       │ B  │                │ │
│ │       └────┘                │ │
│ │  L型窗由两个相连的边组成     │ │
│ │  边A：垂直边 | 边B：水平边  │ │
│ └─────────────────────────────┘ │
│                                 │
│ 边A（垂直边）尺寸               │
│ ┌──────────┐  ┌──────────┐    │
│ │ 宽度     │  │ 高度     │    │
│ │ 1800 mm  │  │ 1500 mm  │    │
│ └──────────┘  └──────────┘    │
│                                 │
│ 边B（水平边）尺寸               │
│ ┌──────────┐  ┌──────────┐    │
│ │ 宽度     │  │ 高度     │    │
│ │ 1800 mm  │  │ 1500 mm  │    │
│ └──────────┘  └──────────┘    │
└─────────────────────────────────┘
```

### 4. 转角窗模式 - U型

```
┌─────────────────────────────────┐
│ 窗型信息                         │
│                                 │
│ 窗户类型：[ 一字窗 ] [转角窗]   │
│                                 │
│ 转角窗类型：[ L型窗 ] [U型窗]   │
│                                 │
│ ┌─────────────────────────────┐ │
│ │  图示说明                   │ │
│ │  ┌──┐      ┌──┐            │ │
│ │  │A │      │C │            │ │
│ │  └──┴──────┴──┘            │ │
│ │     │   B   │              │ │
│ │     └───────┘              │ │
│ │  U型窗由三个相连的边组成    │ │
│ │  A：左垂直 | B：底部 | C：右│ │
│ └─────────────────────────────┘ │
│                                 │
│ 边A（左垂直边）尺寸             │
│ ┌──────────┐  ┌──────────┐    │
│ │ 宽度     │  │ 高度     │    │
│ │ 1800 mm  │  │ 1500 mm  │    │
│ └──────────┘  └──────────┘    │
│                                 │
│ 边B（底部水平边）尺寸           │
│ ┌──────────┐  ┌──────────┐    │
│ │ 宽度     │  │ 高度     │    │
│ │ 1800 mm  │  │ 1500 mm  │    │
│ └──────────┘  └──────────┘    │
│                                 │
│ 边C（右垂直边）尺寸             │
│ ┌──────────┐  ┌──────────┐    │
│ │ 宽度     │  │ 高度     │    │
│ │ 1800 mm  │  │ 1500 mm  │    │
│ └──────────┘  └──────────┘    │
└─────────────────────────────────┘
```

---

## 数据结构

### 状态管理

```typescript
// 窗户类型
const [windowCategory, setWindowCategory] = useState<"straight" | "corner">("straight")

// 转角窗类型
const [cornerType, setCornerType] = useState<"L" | "U">("L")

// 设计数据
const [designData, setDesignData] = useState({
  // 一字窗数据
  width: "",
  height: "",
  
  // 其他保持不变的字段
  budget: "50000",
  location: "客厅",
  floor: "中层",
  houseType: "公寓",
  
  // 转角窗尺寸数据
  cornerDimensions: {
    sideA: { width: "", height: "" },  // 边A
    sideB: { width: "", height: "" },  // 边B
    sideC: { width: "", height: "" },  // 边C（仅U型窗使用）
  }
})
```

### 辅助函数

```typescript
// 更新转角窗尺寸
const updateCornerDimension = (
  side: "sideA" | "sideB" | "sideC", 
  dimension: "width" | "height", 
  value: string
) => {
  setDesignData(prev => ({
    ...prev,
    cornerDimensions: {
      ...prev.cornerDimensions,
      [side]: {
        ...prev.cornerDimensions[side],
        [dimension]: value
      }
    }
  }))
}
```

---

## 技术实现

### 1. 条件渲染

```typescript
{/* 根据窗户类型显示不同内容 */}
{windowCategory === "straight" && (
  <div>
    {/* 一字窗尺寸输入 */}
  </div>
)}

{windowCategory === "corner" && (
  <div>
    {/* 转角窗选项 */}
    {cornerType === "L" && (
      <div>{/* L型窗尺寸输入 */}</div>
    )}
    {cornerType === "U" && (
      <div>{/* U型窗尺寸输入 */}</div>
    )}
  </div>
)}
```

### 2. 可视化图示（SVG）

#### L型窗图示

```tsx
<svg className="w-16 h-16" viewBox="0 0 100 100">
  {/* 垂直边 */}
  <rect x="10" y="10" width="40" height="80" 
    stroke="currentColor" strokeWidth="2" 
    fill="currentColor" fillOpacity="0.1"/>
  
  {/* 水平边 */}
  <rect x="10" y="70" width="80" height="20" 
    stroke="currentColor" strokeWidth="2" 
    fill="currentColor" fillOpacity="0.1"/>
  
  {/* 标签 */}
  <text x="30" y="50">边A</text>
  <text x="50" y="82">边B</text>
</svg>
```

#### U型窗图示

```tsx
<svg className="w-16 h-16" viewBox="0 0 100 100">
  {/* 左垂直边 */}
  <rect x="10" y="10" width="20" height="80"/>
  
  {/* 底部水平边 */}
  <rect x="10" y="70" width="80" height="20"/>
  
  {/* 右垂直边 */}
  <rect x="70" y="10" width="20" height="80"/>
  
  {/* 标签 */}
  <text x="20" y="50">A</text>
  <text x="50" y="82">B</text>
  <text x="80" y="50">C</text>
</svg>
```

### 3. 样式类名

```typescript
// 选择按钮样式
const buttonClasses = cn(
  "flex-1 h-10 rounded-lg border-2 transition-all text-sm font-medium",
  isSelected
    ? "border-primary bg-primary/10 text-primary"
    : "border-border hover:border-primary/50"
)
```

---

## 交互流程

### 1. 选择一字窗

```
用户点击"一字窗"按钮
  ↓
显示简单的宽度/高度输入框
  ↓
用户填写尺寸
  ↓
继续填写其他信息（房屋类型、安装位置等）
  ↓
完成第一步
```

### 2. 选择转角窗 - L型

```
用户点击"转角窗"按钮
  ↓
显示转角窗类型选择
  ↓
用户选择"L型窗"
  ↓
显示L型窗图示和说明
  ↓
用户填写边A尺寸（垂直边）
  ↓
用户填写边B尺寸（水平边）
  ↓
继续填写其他信息
  ↓
完成第一步
```

### 3. 选择转角窗 - U型

```
用户点击"转角窗"按钮
  ↓
显示转角窗类型选择
  ↓
用户选择"U型窗"
  ↓
显示U型窗图示和说明
  ↓
用户填写边A尺寸（左垂直边）
  ↓
用户填写边B尺寸（底部水平边）
  ↓
用户填写边C尺寸（右垂直边）
  ↓
继续填写其他信息
  ↓
完成第一步
```

---

## UI/UX 特点

### 1. 清晰的视觉层次

- **标题**：16px，semibold
- **子标题**：14px，medium
- **说明文字**：12px，regular
- **输入标签**：12px，muted

### 2. 交互反馈

- **选中状态**：蓝色边框 + 浅蓝色背景
- **悬停状态**：边框颜色变淡蓝色
- **焦点状态**：输入框显示焦点环

### 3. 可视化说明

- **SVG图示**：16×16格子，清晰展示结构
- **文字说明**：简短易懂的描述
- **颜色区分**：半透明填充区分各个边

### 4. 响应式布局

- **输入框**：2列网格布局，自适应
- **按钮**：等宽，自动分配空间
- **图示**：固定尺寸，保持清晰

---

## 数据验证

### 必填字段检查

```typescript
// 一字窗验证
const validateStraightWindow = () => {
  return designData.width && designData.height
}

// L型窗验证
const validateLWindow = () => {
  const { sideA, sideB } = designData.cornerDimensions
  return sideA.width && sideA.height && 
         sideB.width && sideB.height
}

// U型窗验证
const validateUWindow = () => {
  const { sideA, sideB, sideC } = designData.cornerDimensions
  return sideA.width && sideA.height && 
         sideB.width && sideB.height && 
         sideC.width && sideC.height
}
```

### 数值范围检查

```typescript
// 尺寸合理性检查
const validateDimension = (value: string) => {
  const num = parseInt(value)
  return num >= 300 && num <= 5000 // 300mm - 5000mm
}
```

---

## 保持不变的字段

以下字段在所有窗户类型中保持不变：

### 1. 房屋类型
- 公寓
- 别墅
- 办公楼
- 商业
- 高层住宅
- 联排别墅

### 2. 安装位置
- 客厅
- 卧室
- 厨房
- 阳台
- 书房
- 其他

### 3. 楼层高度
- 底层
- 中层
- 高层
- 顶层

### 4. 预算范围
- 滑动条选择

---

## 后续步骤影响

### 步骤2：选择窗型

- **一字窗**：显示所有标准窗型
- **L型窗**：可能需要特殊的转角窗型选项
- **U型窗**：可能需要特殊的U型窗型选项

### 步骤3：调细节

- **一字窗**：使用单一画布
- **L型窗**：可能需要两个画布区域
- **U型窗**：可能需要三个画布区域

### 步骤4：换样式

- 所有类型使用相同的材质和参数设置

### 步骤5：看效果

- 根据窗户类型生成相应的报价和效果图

---

## 测试场景

### 1. 基本功能测试

- [ ] 默认显示"一字窗"选项
- [ ] 点击"转角窗"切换到转角窗模式
- [ ] 点击"一字窗"切换回一字窗模式
- [ ] L型窗和U型窗切换正常

### 2. 数据输入测试

- [ ] 一字窗：可以输入宽度和高度
- [ ] L型窗：可以输入边A和边B的尺寸
- [ ] U型窗：可以输入边A、边B和边C的尺寸
- [ ] 数字键盘正常弹出（移动端）

### 3. 数据持久化测试

- [ ] 切换窗户类型后，数据不丢失
- [ ] 切换L型/U型后，公共数据保留
- [ ] 返回一字窗后，原数据恢复

### 4. 视觉效果测试

- [ ] 图示清晰可见
- [ ] 选中状态明显
- [ ] 悬停效果流畅
- [ ] 布局在不同屏幕尺寸下正常

### 5. 响应式测试

- [ ] 桌面端显示正常
- [ ] 平板端显示正常
- [ ] 移动端显示正常
- [ ] 输入框大小适中

---

## 已知限制

### 1. 窗型库限制

当前窗型库主要针对一字窗设计，转角窗可能需要：
- 扩展窗型选项
- 特殊的窗型代码
- 定制的窗型推荐

### 2. 设计工具限制

步骤3的设计工具当前只支持单一画布，转角窗可能需要：
- 多画布支持
- 角度连接处理
- 特殊的梃条布局

### 3. 报价计算

转角窗的报价计算需要考虑：
- 多个边的材料用量
- 角度连接件
- 特殊的安装成本

---

## 未来优化方向

### 1. 3D可视化

```
为转角窗提供3D预览：
- 交互式旋转查看
- 实时尺寸标注
- 角度测量工具
```

### 2. 智能推荐

```
根据房间类型推荐窗户类型：
- 阳台转角 → 推荐L型窗
- 凸窗 → 推荐U型窗
- 规则墙面 → 推荐一字窗
```

### 3. 预设方案

```
提供常见的转角窗预设：
- 小型L型（边A: 1200×1500, 边B: 1500×600）
- 大型L型（边A: 1800×2100, 边B: 2400×800）
- 标准U型（边A/C: 1200×1500, 边B: 2400×800）
```

### 4. AI识别增强

```
从照片中识别转角窗：
- 检测多个平面
- 自动测量角度
- 推荐窗户类型
```

---

## 相关文件

### 修改的文件

1. **app/design/page.tsx**
   - 添加窗户类型状态
   - 添加转角窗类型状态
   - 添加转角窗尺寸数据结构
   - 添加 `updateCornerDimension` 函数
   - 修改窗型信息UI

### 未修改的文件

- 其他步骤的页面和组件保持不变
- 窗型数据库保持不变
- 样式文件保持不变

---

## 代码示例

### 使用方式

```typescript
// 获取当前窗户配置
const getWindowConfig = () => {
  if (windowCategory === "straight") {
    return {
      type: "straight",
      width: designData.width,
      height: designData.height
    }
  } else {
    // 转角窗
    if (cornerType === "L") {
      return {
        type: "corner-L",
        sideA: designData.cornerDimensions.sideA,
        sideB: designData.cornerDimensions.sideB
      }
    } else {
      return {
        type: "corner-U",
        sideA: designData.cornerDimensions.sideA,
        sideB: designData.cornerDimensions.sideB,
        sideC: designData.cornerDimensions.sideC
      }
    }
  }
}
```

---

## 总结

### ✅ 已实现功能

1. **窗户类型选择**
   - 一字窗/转角窗切换

2. **转角窗类型**
   - L型窗
   - U型窗

3. **可视化说明**
   - SVG图示
   - 文字说明

4. **尺寸输入**
   - 每个边独立输入
   - 数字键盘支持

5. **状态管理**
   - 完整的数据结构
   - 辅助更新函数

### 📋 待扩展功能

1. 转角窗专用窗型库
2. 多画布设计工具
3. 转角窗报价计算
4. 3D可视化预览
5. AI识别转角窗

---

**版本**: v3.1.0  
**功能状态**: ✅ 已完成  
**更新时间**: 2025年11月6日

