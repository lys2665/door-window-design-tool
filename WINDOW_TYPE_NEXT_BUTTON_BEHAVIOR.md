# 选窗型步骤"下一步"按钮行为说明

## 功能确认

在步骤2"选择窗型"中，点击"下一步"按钮的行为已正确实现：

## 更新时间

2025年11月6日

---

## 行为逻辑

### 情况1：已选中窗型

```
用户操作：点击"下一步"按钮
    ↓
系统检查：selectedWindowType 存在 ✓
    ↓
系统响应：
  1. canNavigateToStage(3) 返回 true
  2. 直接进入步骤3
  3. 不显示任何 Toast
    ↓
视觉反馈：
  - 页面平滑切换到步骤3
  - 步骤指示器更新
  - 无 Toast 提示
```

### 情况2：未选中窗型

```
用户操作：点击"下一步"按钮
    ↓
系统检查：selectedWindowType 不存在 ✗
    ↓
系统响应：
  1. canNavigateToStage(3) 返回 false
  2. 显示 Toast 提示
  3. 停留在步骤2
    ↓
视觉反馈：
  - Toast 从顶部滑入
  - 提示"请先选择窗型"
  - 页面不跳转
```

---

## 代码实现

### 核心验证逻辑

```typescript
const canNavigateToStage = (targetStage: number): boolean => {
  // 如果目标步骤 > 2（即步骤3及以后），需要检查是否选择了窗型
  if (targetStage > 2 && !selectedWindowType) {
    // 仅在未选中窗型时显示 Toast
    toast.info("请先选择窗型", {
      description: "请在步骤2选择一个窗型后再继续下一步",
    })
    return false
  }
  // 已选中窗型，直接返回 true，不显示 Toast
  return true
}
```

### 下一步按钮逻辑

```typescript
const nextStage = () => {
  if (currentStage < designStages.length) {
    const targetStage = currentStage + 1
    // 验证是否可以进入目标步骤
    if (canNavigateToStage(targetStage)) {
      // 验证通过，跳转（不显示 Toast）
      setCurrentStage(targetStage)
    }
    // 验证失败，不跳转（已在 canNavigateToStage 中显示 Toast）
  }
}
```

---

## 完整交互流程

### 流程A：正常选择流程

```
步骤2: 选择窗型页面
  ↓
用户点击窗型卡片
  ↓
系统：选中窗型 + 自动进入步骤3
  ↓
步骤3: 调细节页面
```

### 流程B：选择后点击"下一步"

```
步骤2: 选择窗型页面
  ↓
用户点击窗型卡片
  ↓
系统：选中窗型 + 自动进入步骤3
  ↓
用户点击"上一步"返回
  ↓
步骤2: 仍显示已选窗型
  ↓
用户点击"下一步"按钮
  ↓
系统：检查到已选窗型 ✓
  ↓
直接进入步骤3（无 Toast）✓
```

### 流程C：未选择直接点击"下一步"

```
步骤2: 选择窗型页面
  ↓
用户未点击任何窗型
  ↓
用户直接点击"下一步"按钮
  ↓
系统：检查未选窗型 ✗
  ↓
显示 Toast："请先选择窗型" ✓
  ↓
停留在步骤2
```

### 流程D：取消选择后点击"下一步"

```
步骤2: 选择窗型页面
  ↓
用户点击窗型A（选中）
  ↓
自动进入步骤3
  ↓
用户返回步骤2
  ↓
用户再次点击窗型A（取消选择）
  ↓
系统：显示 Toast "已取消选择"
  ↓
用户点击"下一步"按钮
  ↓
系统：检查未选窗型 ✗
  ↓
显示 Toast："请先选择窗型" ✓
  ↓
停留在步骤2
```

---

## Toast 显示规则

### 显示 Toast 的情况

| 场景 | Toast 内容 | 是否跳转 |
|------|-----------|---------|
| **未选窗型 + 点击"下一步"** | "请先选择窗型" | 否 ✗ |
| **未选窗型 + 点击步骤3/4/5** | "请先选择窗型" | 否 ✗ |
| **已选窗型 + 再次点击该窗型** | "已取消选择" | 否 ✗ |

### 不显示 Toast 的情况

| 场景 | 行为 |
|------|------|
| **已选窗型 + 点击"下一步"** | 直接跳转 ✓ |
| **已选窗型 + 点击步骤3/4/5** | 直接跳转 ✓ |
| **点击未选窗型** | 选中 + 自动跳转 ✓ |
| **点击其他窗型** | 切换 + 自动跳转 ✓ |

---

## 验证测试

### 测试用例1：已选窗型点击"下一步"

```
前置条件：在步骤2已选中一个窗型
操作步骤：点击"下一步"按钮
预期结果：
  ✓ 直接进入步骤3
  ✓ 不显示任何 Toast
  ✓ 页面平滑切换
```

### 测试用例2：未选窗型点击"下一步"

```
前置条件：在步骤2未选中任何窗型
操作步骤：点击"下一步"按钮
预期结果：
  ✓ 停留在步骤2
  ✓ 显示 Toast："请先选择窗型"
  ✓ Toast 2秒后自动消失
```

### 测试用例3：选择后取消再点击"下一步"

```
前置条件：
  1. 在步骤2选中窗型A
  2. 自动进入步骤3
  3. 返回步骤2
  4. 再次点击窗型A取消选择
操作步骤：点击"下一步"按钮
预期结果：
  ✓ 停留在步骤2
  ✓ 显示 Toast："请先选择窗型"
  ✓ 不会跳转到步骤3
```

### 测试用例4：选择后返回再点击"下一步"

```
前置条件：
  1. 在步骤2选中窗型A
  2. 自动进入步骤3
  3. 返回步骤2（窗型A仍选中）
操作步骤：点击"下一步"按钮
预期结果：
  ✓ 直接进入步骤3
  ✓ 不显示 Toast
  ✓ 保持窗型A选中状态
```

---

## UI 状态对照

### 状态A：未选窗型

```
┌─────────────────────────────────────┐
│ 选择窗型                             │
│ 总数：48 / 48                        │
│                                     │
│ [全部] [简洁] [经济] ...           │
├─────────────────────────────────────┤
│                                     │
│ ⓘ 请选择一个窗型                    │ ← 提示框显示
│   点击下方窗型卡片即可选择...        │
│                                     │
│ [窗型1] [窗型2] [窗型3] ...        │
│                                     │
└─────────────────────────────────────┘
       │
       │ 点击"下一步"
       ↓
┌─────────────────────────────────────┐
│  ⓘ  请先选择窗型                [×] │ ← Toast 显示
│     请在步骤2选择一个窗型后再继续    │
└─────────────────────────────────────┘
     停留在步骤2 ✗
```

### 状态B：已选窗型

```
┌─────────────────────────────────────┐
│ 选择窗型              已选: 001矩形  │ ← "已选"徽章
│ 总数：48 / 48                        │
│                                     │
│ [全部] [简洁] [经济] ...           │
├─────────────────────────────────────┤
│                                     │
│ [窗型1] [窗型2✓] [窗型3] ...       │ ← 选中标记
│                                     │
└─────────────────────────────────────┘
       │
       │ 点击"下一步"
       ↓
     直接进入步骤3 ✓
     无 Toast 显示 ✓
```

---

## 代码验证点

### 关键判断条件

```typescript
// 关键条件1：检查目标步骤
targetStage > 2  // 步骤3、4、5需要验证

// 关键条件2：检查窗型选择状态
!selectedWindowType  // 未选择时为 true

// 组合条件
if (targetStage > 2 && !selectedWindowType) {
  // 仅在"目标是步骤3+"且"未选窗型"时显示 Toast
  toast.info(...)
  return false
}
```

### 逻辑真值表

| targetStage | selectedWindowType | 显示Toast | 允许跳转 |
|-------------|-------------------|----------|---------|
| 1 → 2 | null | ✗ | ✓ |
| 2 → 3 | null | ✓ | ✗ |
| 2 → 3 | 窗型A | ✗ | ✓ |
| 3 → 4 | 窗型A | ✗ | ✓ |
| 2 → 4 | null | ✓ | ✗ |
| 2 → 4 | 窗型A | ✗ | ✓ |

---

## 总结

### ✅ 当前实现正确

代码逻辑已经正确实现了以下行为：

1. **已选窗型 + 点击"下一步"**
   - ✓ 直接进入步骤3
   - ✓ 不显示 Toast
   - ✓ 体验流畅

2. **未选窗型 + 点击"下一步"**
   - ✓ 停留在步骤2
   - ✓ 显示 Toast 提示
   - ✓ 引导用户选择

3. **其他操作**
   - ✓ 点击窗型卡片：自动跳转
   - ✓ 取消选择：显示 Toast
   - ✓ 步骤跳转：统一验证

### 🎯 核心原则

```
Toast 显示规则：
- 仅在"需要窗型"且"未选窗型"时显示
- 已选窗型时，任何导航操作都不显示 Toast
- 保持操作流畅，减少不必要的提示
```

---

**版本**: v3.3.2  
**状态**: ✅ 已验证正确  
**更新时间**: 2025年11月6日

